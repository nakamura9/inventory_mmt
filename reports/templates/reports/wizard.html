{% extends "window.html" %}
{% block content %}
<div class="row">
    <div class="col-sm-4"></div>
    <div class="col-sm-4 bg-info" style="padding:30px;">
            <h1>New Report</h1>
            <h3>Step <span id="step">{{wizard.steps.step1}} of 2</span>:</h3>
            <div class="well">
                <form acton=="" method="POST">
                    {% csrf_token %}
                    <table>
                    {{wizard.management_form}}
                    {% if wizard.form.forms %}
                        {{wizard.form.management_form}}
                        {% for form in wizard.form.forms %}
                            {{form}}
                        {% endfor %}
                    {% else %}
                        {{wizard.form}}
                    {% endif %}
                    </table>
                    {% if wizard.steps.prev %}
                        <button name="wizard_goto_step" class="btn btn-info" type="submit" value="{{ wizard.steps.first }}"> "first step"</button>
                        <button name="wizard_goto_step" class="btn btn-info" type="submit" value="{{ wizard.steps.prev}}"> prev step</button>
                    {% endif %}
                    <input type="submit" class="btn btn-primary" value="submit"
                    </table>
                </form>

            </div>
    </div>
    <div class="col-sm-4">
        {% if "spares" in wizard.form.fields %}
            <div class="bg-info" style="padding:20px;" id="spares-list">
                <h2>Spares Chosen</h2>
                <p>Leave blank if covering all equipment</p>
            </div>
        {% elif "equipment" in wizard.form.fields %}
            <div class="bg-info" style="padding:20px;" id="equipment-list">
                <h2>Equipment Filtered</h2>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
{% block body_script %}

{% if "category" in wizard.form.fields %}

$("#id_0-start_period").datepicker();
$("#id_0-end_period").datepicker();

{% elif "spares" in wizard.form.fields %}

function addItem(){
    var val = $("#id_2-spares").val();
    if(checkInput("id_2-spares")){
        var _id = saferId(val);
        addHiddenInput(_id, "spares_chosen", val);
        addItemToList("spares-list", val, _id,"removeItem('"+_id+"')");
        $("#id_2-spares").val("");
    }
}

function removeItem(id){
    $("#"+id).remove();
    $("#spares-list_item_"+id).remove();
}

{% elif "equipment" in wizard.form.fields %}
function addItem(){
    var val = $("#id_1-equipment").val();
    if(checkInput("id_1-equipment")){
        var _id = saferId(val);
        addHiddenInput(_id, "equipment_chosen[]", val);
        addItemToList("equipment-list", val, _id,"removeItem('"+_id+"')");
    }
}

function removeItem(id){
    $("#"+id).remove();
    $("#equipment-list_item_"+id).remove();
}

function selectModel(){
    var model = $("#id_1-level").val();
    $("#id_1-equipment").on("keyup", function(e){
        if($("#id_1-equipment").val().length > 2){
            updateDatalist("id_1-equipment", $("#id_1-level").val(), "1-equipment_datalist");
        }
    })    
}
{% elif "machine" in wizard.form.fields %}

function prepSectionUpdate(){
    var url = "{% url 'ajax:update_section' %}";
    var machine = $('#id_1-machine').val();
    var section = $('#id_1-section');
    updateSections(url, machine, section);
}


function prepSubUnitUpdate(){
    var url = "{% url 'ajax:update_subunit' %}";
    var section = $('#id_1-section').val();
    var subunit = $('#id_1-subunit');
    updateSubUnits(url, section, subunit);
}

function prepSubAssemblyUpdate(){
    var url = "{% url 'ajax:update_subassembly' %}";
    var subunit = $('#id_1-subunit').val();
    var subassembly = $('#id_1-subassembly');
    updateSubAssemblies(url, subunit, subassembly);
}

function prepComponentUpdate(){
    var url = "{% url 'ajax:update_component' %}";
    var subassembly = $('#id_1-subassembly').val();
    var component = $('#id_1-component');
    updateComponents(url, subassembly, component);
}


{% endif %}
    
{% endblock %}





